apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "dagu.fullname" . }}-config
  labels:
    {{- include "dagu.labels" . | nindent 4 }}
data:
  dagu.yaml: |
    # Dagu configuration for Kubernetes (v0 Helm chart)
    # This file intentionally includes only the minimal,
    # schema-correct configuration required to run dagu
    # in a distributed Kubernetes environment.

    # Server / UI
    host: "0.0.0.0"
    port: 8080
    api_base_path: "/api/v1"
    default_execution_mode: "distributed"

    # Coordinator (distributed execution)
    coordinator:
      host: "0.0.0.0"
      port: 50055

    # Scheduler
    scheduler:
      port: 8090

    # Paths (MUST be under `paths`)
    paths:
      data_dir: /data
      dags_dir: /data/dags
      log_dir: /data/logs
      suspend_flags_dir: /data/suspend
      admin_logs_dir: /data/admin/logs
      dag_runs_dir: /data/dag-runs
      queue_dir: /data/queue
      proc_dir: /data/proc
      service_registry_dir: /data/services
      api_keys_dir: /data/api-keys
      webhooks_dir: /data/webhooks
      users_dir: /data/users

    # Auth
    auth:
      mode: {{ .Values.auth.mode | quote }}
      builtin:
        admin:
          username: {{ .Values.auth.builtin.admin.username | quote }}
          password: {{ .Values.auth.builtin.admin.password | quote }}
        token:
          secret: {{ .Values.auth.builtin.token.secret | quote }}
          ttl: {{ .Values.auth.builtin.token.ttl | quote }}

    # Peer communication (required for distributed mode)
    peer:
      insecure: true
