services:
  boltbase:
    image: ghcr.io/dagu-org/boltbase:latest
    container_name: boltbase-dev
    hostname: boltbase-dev

    # Expose the web UI on localhost:8080
    ports:
      - "8080:8080"

    entrypoint: [] # Override any default entrypoint for Docker in Docker (DinD) support

    # Default command: run all-in-one (server + scheduler + coordinator in-process)
    # You may override this at runtime, e.g.:
    #   docker compose -f compose.dev.yaml run --rm boltbase boltbase server
    command: ["boltbase", "start-all"]

    # Recommended dev environment variables
    environment:
      # Frontend server
      - BOLTBASE_HOST=0.0.0.0 # Bind inside container
      - BOLTBASE_PORT=8080 # Web/UI port inside container
      - BOLTBASE_DEBUG=true # More verbose logs during dev
      # Paths
      - BOLTBASE_DAGS_DIR=/var/lib/boltbase/dags
      # Builtin authentication (RBAC) - CHANGE TOKEN_SECRET IN PRODUCTION
      - BOLTBASE_AUTH_MODE=builtin
      - BOLTBASE_AUTH_TOKEN_SECRET=CHANGE_ME_TO_A_SECURE_RANDOM_STRING
      # Admin credentials: password auto-generated on first run, printed to stdout
      # - BOLTBASE_AUTH_ADMIN_USERNAME=admin # default is 'admin'
      # - BOLTBASE_AUTH_ADMIN_PASSWORD=      # set to use a specific password
      # - BOLTBASE_AUTH_TOKEN_TTL=24h        # default is 24h
      # Timezone / base path (optional)
      # - BOLTBASE_TZ=UTC
      # - BOLTBASE_BASE_PATH=/boltbase
      # User and Group IDs (optional, for file permissions)
      # - PUID=1000 # optional. default is 1000
      # - PGID=1000 # optional. default is 1000

    # Dev-friendly mounts (persistent data + read-only DAGs)
    volumes:
      - boltbase-data:/var/lib/boltbase
      - ./dags:/var/lib/boltbase/dags:ro
      # For Docker in Docker (DinD) support, mount the host Docker socket:
      - /var/run/docker.sock:/var/run/docker.sock

    # Quick command presets (uncomment any one to run specific component):
    # command: ["boltbase", "server"]
    # command: ["boltbase", "scheduler"]
    # command: ["boltbase", "coordinator"]
    # command: ["boltbase", "worker"]

    # Alternative: basic auth (simpler, no user management)
    # To use basic auth instead of builtin auth, comment out
    # BOLTBASE_AUTH_MODE and BOLTBASE_AUTH_TOKEN_SECRET above, then uncomment:
    # environment:
    #   - BOLTBASE_AUTH_BASIC_USERNAME=dev
    #   - BOLTBASE_AUTH_BASIC_PASSWORD=devpass

    user: "0:0" # Run as root for Docker in Docker (DinD) support

volumes:
  boltbase-data:
    driver: local
